@inherits LayoutComponentBase
@using GreenTrade.Client.Components
@inject GreenTrade.Client.Services.IAuthService AuthService
@inject NavigationManager Navigation

<div class="main-layout">
    <NotificationToast />
    
    <AuthorizeView>
        <Authorized>
            <!-- Desktop Sidebar -->
            <nav class="sidebar">
                <div class="mb-5 px-2">
                    <h3 class="text-white mb-0"><i class="fas fa-leaf me-2"></i>GreenTrade</h3>
                    <small class="text-white-50">Plataforma de Café</small>
                </div>
                
                <NavMenu />

                <div class="mt-auto pt-5">
                    <button class="btn btn-outline-light w-100" @onclick="Logout">
                        <i class="fas fa-sign-out-alt me-2"></i> Sair
                    </button>
                </div>
            </nav>

            <main class="content-container">
                <header class="d-flex justify-content-between align-items-center mb-4 d-none d-md-flex">
                    <div>
                        <h4 class="mb-0">@GetGreeting(), @context.User.Identity?.Name!</h4>
                        <p class="text-muted small">@DateTime.Now.ToString("D", new System.Globalization.CultureInfo("pt-BR"))</p>
                    </div>
                </header>

                @Body
            </main>

            <!-- Mobile Bottom Bar -->
            <nav class="bottom-nav">
                <NavLink class="bottom-nav-item" href="" Match="NavLinkMatch.All">
                    <i class="fas fa-chart-pie"></i>
                    <span>Início</span>
                </NavLink>
                <NavLink class="bottom-nav-item" href="alerts">
                    <i class="fas fa-bell"></i>
                    <span>Alertas</span>
                </NavLink>
                <NavLink class="bottom-nav-item" href="profile">
                    <i class="fas fa-user"></i>
                    <span>Perfil</span>
                </NavLink>
                <NavLink class="bottom-nav-item" href="help">
                    <i class="fas fa-question-circle"></i>
                    <span>Ajuda</span>
                </NavLink>
            </nav>
        </Authorized>
        <NotAuthorized>
            <div class="w-100">
                @Body
            </div>
        </NotAuthorized>
    </AuthorizeView>
</div>

@code {
    private string GetGreeting()
    {
        var hour = DateTime.Now.Hour;
        if (hour < 12) return "Bom dia";
        if (hour < 18) return "Boa tarde";
        return "Boa noite";
    }

    private async Task Logout()
    {
        await AuthService.Logout();
        Navigation.NavigateTo("login");
    }
}
