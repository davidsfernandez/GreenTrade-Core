@using GreenTrade.Shared.DTOs
@inject GreenTrade.Client.Services.FormatterService Formatter

<div class="card h-100 @(isPriceUp ? "border-success" : "border-danger")">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-start">
            <div>
                <h6 class="text-muted mb-1">@Title (@Ticker)</h6>
                <h3 class="mb-0 @priceClass">
                    @if (Ticker == "USDBRL")
                    {
                        @Formatter.FormatCurrency(Price)
                    }
                    else
                    {
                        <span>@Price.ToString("N2") </span><small class="fs-6">cts/lb</small>
                    }
                </h3>
            </div>
            <div class="@(Change >= 0 ? "text-success" : "text-danger")">
                <i class="fas @(Change >= 0 ? "fa-arrow-up" : "fa-arrow-down")"></i>
                @Change.ToString("N2")%
            </div>
        </div>
        <div class="mt-3">
            <small class="text-muted">
                <i class="far fa-clock"></i> @Formatter.FormatDateTime(LastUpdate)
            </small>
        </div>
    </div>
</div>

@code {
    [Parameter] public string Title { get; set; } = "";
    [Parameter] public string Ticker { get; set; } = "";
    [Parameter] public decimal Price { get; set; }
    [Parameter] public decimal Change { get; set; }
    [Parameter] public DateTime LastUpdate { get; set; }

    private string priceClass = "";
    private bool isPriceUp = true;
    private decimal lastPrice;

    protected override void OnParametersSet()
    {
        if (lastPrice != 0 && Price != lastPrice)
        {
            priceClass = Price > lastPrice ? "price-up" : "price-down";
            isPriceUp = Price > lastPrice;
            
            // Reset class after animation
            Task.Delay(1000).ContinueWith(_ => 
            {
                priceClass = "";
                InvokeAsync(StateHasChanged);
            });
        }
        lastPrice = Price;
    }
}
